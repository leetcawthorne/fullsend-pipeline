<body>
  <!-- DVOS page assets -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // 1️⃣ Determine background
      let bgPath;
      {% if page.collection == "dvos" and page.background_asset %}
        bgPath = "{{ page.background_asset | relative_url }}";
      {% else %}
        bgPath = "{{ '/assets/images/header-bg.jpg' | relative_url }}";
      {% endif %}
      document.body.style.backgroundImage = `url('${bgPath}')`;
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundPosition = "center";

      // 2️⃣ Apply logo dynamically if present
      const logoElement = document.querySelector('img#site-logo');
      {% if page.logo %}
        if (logoElement) logoElement.src = "{{ page.logo | relative_url }}";
      {% endif %}

      // 3️⃣ Store theme and button assets for JS
      window.dvosThemes = {
        light: "{{ page.theme_light | relative_url }}",
        dark: "{{ page.theme_dark | relative_url }}"
      };
      window.dvosButtons = {
        primarySvg: "{{ page.button_primary_svg | relative_url }}",
        secondarySvg: "{{ page.button_secondary_svg | relative_url }}",
        primaryJson: "{{ page.button_primary_json | relative_url }}",
        secondaryJson: "{{ page.button_secondary_json | relative_url }}"
      };
      window.visualProfilePath = "{{ page.visual_profile | relative_url }}";

      // 4️⃣ Fetch visual profile JSON
      fetch(window.visualProfilePath)
        .then(response => {
          if (!response.ok) throw new Error("Visual profile not found");
          return response.json();
        })
        .then(data => {
          console.log("✅ Visual Profile Loaded:", data);

          // Apply theme mode
          if (data.theme_alignment && data.theme_alignment.includes("dark")) {
            document.body.classList.add("dark-mode");
          } else {
            document.body.classList.remove("dark-mode");
          }

          // Accent colors for special profiles
          if (data.profile === "Energetic Creator") {
            document.documentElement.style.setProperty('--accent-color', '#FF4B2B');
            document.documentElement.style.setProperty('--accent-hover', '#FF6A3D');
          }
        })
        .catch(error => console.error("⚠️ Visual Profile Load Error:", error));
    });
  </script>
